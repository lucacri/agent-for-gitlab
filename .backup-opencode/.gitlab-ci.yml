# GitLab CI/CD Configuration for AI Code Webhook Server
# This pipeline is triggered by the webhook server when @ai is mentioned
# If you drop this into an existing pipeline make sure that only the ai stage is triggered when $AI_TRIGGER is set.

stages:
  - ai

variables:
  # Specify the prebuilt agent image containing the runner and tools
  AI_AGENT_IMAGE: "ghcr.io/schickli/agent-for-gitlab/agent-image:latest"
  
ai_webhook_handler:
  stage: ai
  image: $AI_AGENT_IMAGE
  script:
    - ai-runner
  rules:
    - if: '$AI_TRIGGER == "true"'
  artifacts:
    paths:
      - ai-output.json
    expire_in: 1 week
